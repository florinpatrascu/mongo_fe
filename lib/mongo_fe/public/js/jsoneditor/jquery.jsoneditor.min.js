(function(f){function t(b,a,c,d,e){b={target:b,onchange:c,original:a,propertyElement:d,valueElement:e};l(b,a,b.target);f(".property, .value",b.target).live("blur focus",function(){f(this).toggleClass("editing")})}function j(b){return Object.prototype.toString.call(b)=="[object Object]"}function k(b){return Object.prototype.toString.call(b)=="[object Array]"}function m(b,a,c){var d=arguments.length==2;if(a.indexOf(".")>-1){for(var e=b,g=0,h=a.split("."),i=h.length;g<i-1;g++)e=e[h[g]];if(d)delete e[h[i-
1]];else e[h[i-1]]=c}else if(d)delete b[a];else b[a]=c;return b}function n(b){var a;try{a=JSON.parse(b)}catch(c){a=null;window.console&&console.error("JSON parse failed.")}return a}function o(b){var a;try{a=JSON.stringify(b)}catch(c){a="null";window.console&&console.error("JSON stringify failed.")}return a}function p(b){if(b.children(".expander").length==0){var a=f("<span>",{"class":"expander"});a.bind("click",function(){f(this).parent().toggleClass("expanded")});b.prepend(a)}}function l(b,a,c,d){d=
d||"";c.children(".item").remove();for(var e in a)if(a.hasOwnProperty(e)){var g=f("<div>",{"class":"item","data-path":d}),h=f(b.propertyElement||"<input>",{"class":"property"}),i=f(b.valueElement||"<input>",{"class":"value"});if(j(a[e])||k(a[e]))p(g);g.append(h).append(i);c.append(g);h.val(e).attr("title",e);var q=o(a[e]);i.val(q).attr("title",q);r(g,a[e]);h.change(u(b));i.change(v(b));if(j(a[e])||k(a[e]))l(b,a[e],g,(d?d+".":"")+e)}}function s(b,a){f(b).parentsUntil(a.target).each(function(){var c=
f(this).data("path");c=(c?c+".":c)+f(this).children(".property").val();var d;a:{d=a.original;c=c.split(".");for(var e=0;e<c.length;)if((d=d[c[e++]])==undefined){d=null;break a}}d=o(d);f(this).children(".value").val(d).attr("title",d)})}function u(b){return function(){var a=f(this).parent().data("path"),c=n(f(this).next().val()),d=f(this).val(),e=f(this).attr("title");f(this).attr("title",d);m(b.original,(a?a+".":"")+e);if(d)m(b.original,(a?a+".":"")+d,c);s(this,b);d||f(this).parent().remove();b.onchange()}}
function v(b){return function(){var a=f(this).prev().val(),c=n(f(this).val()||"null"),d=f(this).parent(),e=d.data("path");m(b.original,(e?e+".":"")+a,c);if((j(c)||k(c))&&!f.isEmptyObject(c)){l(b,c,d,(e?e+".":"")+a);p(d)}else d.find(".expander, .item").remove();r(d,c);s(this,b);b.onchange()}}function r(b,a){var c="null";if(j(a))c="object";else if(k(a))c="array";else if(Object.prototype.toString.call(a)=="[object Boolean]")c="boolean";else if(Object.prototype.toString.call(a)=="[object String]")c="string";
else if(Object.prototype.toString.call(a)=="[object Number]")c="number";b.removeClass(w);b.addClass(c)}f.fn.jsonEditor=function(b,a){a=a||{};var c,d=a.change||function(){};return this.each(function(){t(f(this),b,d,a.propertyElement,a.valueElement)})};var w="object array boolean number string null"})(jQuery);
